## 新闻采集分析子系统用户手册

手册修改记录：

| 修改日期  | 版本 | 修改页码、章节、条款 | 修改描述     | 作者   |
| --------- | ---- | -------------------- | ------------ | ------ |
| 2021-5-16 | 0.1  |                      | 创建所有条款 | 赵云启 |
|           |      |                      |              |        |
|           |      |                      |              |        |

___

### 一、编写目的

​	编写此手册的目的是为了对使用此系统的用户提供正确的使用方法，由于本系统为博物馆应用系统的子系统，并且由于本系统的特性，本系统的主要功能对应用用户来说是透明的。所以，本系统的实际用户为后台的管理者与负责信息采集的相关人员。

​	读者对象：后台的管理者与负责信息采集的相关人员

#### 项目背景

子系统名称：新闻采集分析子系统

子系统任务提出者：北京化工大学信息科学与技术学院

开发者：赵云启、李明宇、蔡爽、魏民、王俊龙

用户：后台的管理者与负责信息采集的相关人员

实现软件单位：计科1807-新闻采集分析子系统小组

#### 定义

新闻(news)：在此子系统中，新闻不但仅仅指通俗意义上的新闻，也作为一种数据结构，其具体包含一个唯一确定的id、标题、发布时间、内容、作者、爬取时间、链接、相关博物馆、分类1、分类2、分类3。

#### 参考资料

1.新闻采集分析子系统项目管理计划

2.新闻采集分析子系统需求规格说明

3.新闻采集分析子系统设计报告

4.新闻采集分析子系统测试报告

5.《计算机软件文档编制规范》

6.《计算机软件文档编制规范》

7.孙家广学生文档范例

### 二、软件概述

#### 目标

新闻采集分析子系统是博物馆应用不可缺少的部分，新闻采集分析子系统为整个系统提供底层数据，并结合大规模机器学习和深度学习等技术，对已有的底层数据进行处理、分析和发掘、提取有价值的信息和知识，实现数据智能。所以新闻采集分析子系统应该能够为使用者提供充足的信息和快捷的查询手段、并提供方便简单的信息分析功能。基于此，可提炼出“数据获取”，“数据加工”，“数据分析”，“数据定制”四种功能。

#### 功能

本系统主要分为两大模块：

1.数据获取模块：

​	功能：获取互联网上博物馆的新闻、定时获取新闻、存入数据库、根据特定要求获取互联网上的新闻

2.数据加工模块：

​	功能：对给定的新闻进行处理、进行分类

#### 性能

1.能够及时的响应用户的请求信息

2.能够同时处理多个用户的请求信息

3.能够按特定要求获得信息

4.必须要有网络的支持

### 三、运行环境

#### 硬件

计算机型号：服务器或者具有奔腾及以上处理器的PC机

内存容量：64M

输入设备：键盘

输出设备：无

#### 支持软件

操作系统：macOS 10.15.7，window10，CentOS 8

浏览器：Firefox，Chrome，safari

数据库：mysql 8

### 四、使用说明

#### 安装和初始化

该系统需要安装mysql数据库，服务器或web服务器，Firefox浏览器，在有网络的条件下使用

#### 输入输出

1.本系统直接运行于服务器，首先进入服务器宝塔面板。

![CE52DA92-5960-402F-B685-123CDCC71AE5](https://tva1.sinaimg.cn/large/008i3skNly1gqmpnwy4qcj31ce0u012z.jpg)



2.在文件菜单下寻找pycode/news文件夹进入核心程序区，其中news.py是每日定时爬取任务代码，classifier.py是分类模块代码，DCS.py是定制模块代码。

![F00CB6F1-61BB-4916-B914-53405D1DA0F8](https://tva1.sinaimg.cn/large/008i3skNly1gqmppv15qwj317u0u0k19.jpg)



3.双击打开上述文件中news.py，文件最上方是该程序的最初作者，之后是每一次改变程序的记录。在此程序中，有一些重要代码片段需要详细介绍

![63DEA815-2118-48D0-A4AC-42DF911E4333](https://tva1.sinaimg.cn/large/008i3skNly1gqmptidj1dj317u0u0154.jpg)

| 代码块名称             | [类别]内容                                | 说明                                                         |
| ---------------------- | ----------------------------------------- | ------------------------------------------------------------ |
| config                 | [字典]数据库存储格式                      | 如果数据库存储格式发生变化，需要对应数据库调整这里，一般情况下不需要调整 |
| conn                   | [mysql]mysql数据库连接方式                | 在开发环境测试时，需要转化为本地，在服务器上部署时，需要转化为服务器 |
| sql                    | [str]sql语句                              | 将爬虫得到的结果存入mysql数据库中，在不改变数据库情况下不动  |
| get_stop_time(days=-1) | [函数]爬取新闻的最早时间                  | 在自动爬取模式下，每次爬取的新闻发布时间不得早于今天0点。以2021-5-13-23:55:00为例，爬取的新闻发布时间应该在2021-5-13-00:00:00之后，可以通过days参数调整距离。同时，因为是定时爬取，该时间应与定时任务的间隔一致 |
| to_excel               | [函数]返回一个爬取新闻结果的csv表作为备份 | 新闻表的名称为baidu-+"当前时间"。                            |
| __URL                  | [str]爬取网站的地址                       | 默认为百度，一般情况不做更改                                 |



4.双击打开上述文件中classifier.py，文件最上方是该程序的最初作者，之后是每一次改变程序的记录。在此程序中，有一些重要代码片段需要详细介绍

![87B5C87D-060B-4825-BAA4-6DA39B7A9F52](https://tva1.sinaimg.cn/large/008i3skNly1gqmq6g0iu7j31gi0u07gl.jpg)

| 代码块名称  | [类别]内容                   | 说明       |
| ----------- | ---------------------------- | ---------- |
| API_key     | [str]百度接口API_key         | 不需要改动 |
| Secret_Key  | [str]百度接口Secret_Key      | 不需要改动 |
| class_nameX | [字典]类别id和对应的分类名称 | 不需要改动 |

4.双击打开上述文件中DCS.py。在此程序中，有一些重要代码片段需要详细介绍

![AA92F024-E58D-4BDA-B0AF-B8A24A825039](https://tva1.sinaimg.cn/large/008i3skNly1gqmq9x1edbj31c90u0dv4.jpg)

| 代码块名称 | [类别]内容                      | 说明                                                         |
| ---------- | ------------------------------- | ------------------------------------------------------------ |
| name       | [input:str]所要爬取的博物馆名称 | 输入应该是一个明确的博物馆，例如“故宫博物馆”                 |
| start      | [input:str]start <=新闻发布时间 | 支持两种格式输入"2021-1-1"或"2021-01-01"                     |
| end        | [input:str]新闻发布时间 <= end  | 支持两种格式输入"2021-1-1"或"2021-01-01",但输入的时间应该在start之后 |
| classify   | [bool]是否将得到的新闻进行分类  | 默认为True，自动分类，如果不想分类，可以改为False            |

#### 出错和恢复

用户使用该系统时，如果出现报错信息，应先查看文档检查输入格式是否正确，再联系相关工作人员进行处理，请勿改变相关的上述代码以外的配置文件。

#### 求助查询

用户打开系统后，可在代码里看到相关维护人员的联系方式

### 五、运行说明

#### 运行表

| 功能             | 操作                                                         | 运行目的                                                     |
| ---------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 百度定时爬取任务 | 无                                                           | 每天爬取百度上博物馆的新闻，自动进行分类，并存入数据库中     |
| 分类任务         | 输入博物馆新闻标题                                           | 得到博物馆新闻的正负类别、关联类别                           |
| 数据定制服务     | 输入博物馆名称，新闻发布时间下界，新闻发布时间上界，是否自动分类 | 返回这段时间内所有关于该博物馆的新闻，若自动分类功能被选中，则自动进行分类。将最终结果存入数据库 |

#### 运行步骤

百度定时爬取任务：登录服务器宝塔面板，计划任务菜单，找到“每天爬新闻，并给新闻做分类”，点击执行，或者进行编辑改变定时任务运行的时间。

分类任务：登录服务器宝塔面板，终端菜单，在终端中输入python /pycode/news/classifier.py

数据定制服务：登录服务器宝塔面板，终端菜单，在终端中输入python /pycode/news/DCS.py，之后根据提示进行输入。

#### 操作信息

| 功能             | 启动方法   | 预计运行时间 |
| ---------------- | ---------- | ------------ |
| 百度定时爬取任务 | 自启动     | 10s          |
| 分类任务         | 命令行方法 | 1-2s         |
| 数据定制服务     | 命令行方法 | 20s          |

### 六、非常规过程

根据命令行的运行结果提示不同的信息，遇到错误信息根据“出错与恢复”部分处理

### 七、程序文件（或命令文件）和数据文件一览表

| 文件名      | 文件类型   |
| ----------- | ---------- |
| news.sql    | 数据库文件 |
| xx.py       | 运行文件   |
| geckodriver | 驱动文件   |

news结构在数据库中的存储方式

| 字段中文（注释） | 字段英文            | 字段类型 | 备注                |
| ---------------- | ------------------- | -------- | ------------------- |
| 新闻编号         | Id                  | int      | key（自增）不能为空 |
| 标题             | Title               | char     |                     |
| 作者             | Author              | char     |                     |
| 新闻发布时间     | Time                | Date     |                     |
| 新闻内容         | Content             | char     |                     |
| 原文链接         | Link                | char     |                     |
| 爬取时间         | GetTime             | Datetime |                     |
| 相关博物馆名称   | MumName             | char     |                     |
| 分类1            | ClassificationOne   | char     |                     |
| 分类2            | ClassificationTwo   | char     |                     |
| 分类3            | ClassificationThree | char     |                     |